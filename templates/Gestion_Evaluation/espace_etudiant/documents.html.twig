{% extends 'base.html.twig' %}

{% block title %}Mes Demandes de Documents{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-file-alt"></i> Mes Demandes de Documents</h1>
        <a href="{{ path('app_espace_etudiant_document_request') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Nouvelle Demande
        </a>
    </div>
    
    {% if documentRequests|length > 0 %}
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Type de Document</th>
                            <th>Date de Demande</th>
                            <th>Statut</th>
                            <th>Date de Livraison</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for request in documentRequests %}
                        <tr>
                            <td>
                                <strong>
                                    {% if request.documentType == 'attestation_stage' %}
                                        Attestation de Stage
                                    {% elseif request.documentType == 'attestation_inscription' %}
                                        Attestation d'Inscription
                                    {% elseif request.documentType == 'releve_notes' %}
                                        Relevé de Notes
                                    {% elseif request.documentType == 'attestation_reussite' %}
                                        Attestation de Réussite
                                    {% elseif request.documentType == 'certificat_scolarite' %}
                                        Certificat de Scolarité
                                    {% else %}
                                        {{ request.documentType }}
                                    {% endif %}
                                </strong>
                                {% if request.additionalInfo %}
                                    <br><small class="text-muted">{{ request.additionalInfo }}</small>
                                {% endif %}
                            </td>
                            <td>{{ request.requestedAt|date('d/m/Y H:i') }}</td>
                            <td>
                                <span class="badge 
                                    {% if request.status == 'pending' %}bg-warning
                                    {% elseif request.status == 'approved' %}bg-info
                                    {% elseif request.status == 'ready' %}bg-success
                                    {% elseif request.status == 'delivered' %}bg-primary
                                    {% else %}bg-danger{% endif %}">
                                    {% if request.status == 'pending' %}En Attente
                                    {% elseif request.status == 'approved' %}Approuvée
                                    {% elseif request.status == 'ready' %}Prête
                                    {% elseif request.status == 'delivered' %}Livrée
                                    {% else %}Rejetée{% endif %}
                                </span>
                            </td>
                            <td>
                                {% if request.deliveredAt %}
                                    {{ request.deliveredAt|date('d/m/Y H:i') }}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if request.documentPath and request.status == 'ready' or request.status == 'delivered' %}
                                    <a href="{{ asset('uploads/documents/' ~ request.documentPath) }}" class="btn btn-sm btn-success" target="_blank">
                                        <i class="fas fa-download"></i> Télécharger
                                    </a>
                                {% else %}
                                    <span class="text-muted">Non disponible</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> Vous n'avez aucune demande de document pour le moment.
    </div>
    {% endif %}
    
    <div class="card mt-4 bg-light">
        <div class="card-body">
            <h5><i class="fas fa-info-circle"></i> Informations sur les Demandes</h5>
            <ul class="mb-0">
                <li><strong>Délai de traitement:</strong> 3-5 jours ouvrables</li>
                <li><strong>Notification:</strong> Vous recevrez un email lorsque votre document sera prêt</li>
                <li><strong>Validité:</strong> Les documents sont valables pendant 3 mois</li>
                <li><strong>Questions:</strong> Contactez le service scolarité pour toute question</li>
            </ul>
        </div>
    </div>
    
    <div class="mt-4">
        <a href="{{ path('app_espace_etudiant_dashboard') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Retour au tableau de bord
        </a>
    </div>
</div>
{% endblock %}
