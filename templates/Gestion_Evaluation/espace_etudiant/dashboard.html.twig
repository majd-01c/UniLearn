{% extends 'base.html.twig' %}

{% block title %}Espace Étudiant - Tableau de Bord{% endblock %}

{% block body %}
<div class="container-fluid mt-4 px-4 animate-in">
    {# Page Header #}
    <div class="uni-page-header">
        <div class="uni-page-header-info">
            <h1 class="uni-page-header-title">
                <i class="bi bi-mortarboard-fill"></i> Espace Étudiant
            </h1>
            <p class="uni-page-header-subtitle">Bienvenue dans votre tableau de bord académique</p>
        </div>
    </div>

    {# Stat Cards #}
    <div class="row g-4 mb-4 stagger-in">
        <div class="col-6 col-lg-3">
            <div class="uni-stat-card bg-gradient-purple">
                <div class="uni-stat-card-content">
                    <div class="uni-stat-card-icon"><i class="bi bi-graph-up"></i></div>
                    <div class="uni-stat-card-value">{{ semesterResults.overallAverage }}/20</div>
                    <div class="uni-stat-card-label">Moyenne Générale</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3">
            <div class="uni-stat-card bg-gradient-emerald">
                <div class="uni-stat-card-content">
                    <div class="uni-stat-card-icon"><i class="bi bi-check-circle-fill"></i></div>
                    <div class="uni-stat-card-value">{{ semesterResults.passedCourses }}</div>
                    <div class="uni-stat-card-label">Cours Réussis</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3">
            <div class="uni-stat-card bg-gradient-rose">
                <div class="uni-stat-card-content">
                    <div class="uni-stat-card-icon"><i class="bi bi-arrow-up-circle-fill"></i></div>
                    <div class="uni-stat-card-value">{{ recommendations|length }}</div>
                    <div class="uni-stat-card-label">Cours à Améliorer</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3">
            <div class="uni-stat-card bg-gradient-sky">
                <div class="uni-stat-card-content">
                    <div class="uni-stat-card-icon"><i class="bi bi-journal-bookmark-fill"></i></div>
                    <div class="uni-stat-card-value">{{ semesterResults.courses|length }}</div>
                    <div class="uni-stat-card-label">Total Cours</div>
                </div>
            </div>
        </div>
    </div>

    {# Quick Access Grid #}
    <div class="row g-4 mb-4 stagger-in">
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_espace_etudiant_grades') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-primary text-white">
                    <i class="bi bi-graph-up-arrow"></i>
                </div>
                <span class="uni-quick-link-title">Mes Notes</span>
                <p class="uni-quick-link-desc">Consulter les notes</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_student_learning_index') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-success text-white">
                    <i class="bi bi-journal-bookmark-fill"></i>
                </div>
                <span class="uni-quick-link-title">My Learning</span>
                <p class="uni-quick-link-desc">Accéder à vos cours</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_espace_etudiant_schedule') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-info text-white">
                    <i class="bi bi-calendar-week-fill"></i>
                </div>
                <span class="uni-quick-link-title">Emploi du Temps</span>
                <p class="uni-quick-link-desc">Planning hebdomadaire</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_espace_etudiant_recommendations') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-warning text-white">
                    <i class="bi bi-lightbulb-fill"></i>
                </div>
                <span class="uni-quick-link-title">IA Recommandations</span>
                <p class="uni-quick-link-desc">Suggestions personnalisées</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_espace_etudiant_reclamations') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-danger text-white">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                </div>
                <span class="uni-quick-link-title">Réclamations</span>
                <p class="uni-quick-link-desc">Soumettre une demande</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_espace_etudiant_documents') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-success text-white">
                    <i class="bi bi-file-earmark-text-fill"></i>
                </div>
                <span class="uni-quick-link-title">Documents</span>
                <p class="uni-quick-link-desc">Demander un document</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_espace_etudiant_results') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-amber text-white">
                    <i class="bi bi-trophy-fill"></i>
                </div>
                <span class="uni-quick-link-title">Résultats</span>
                <p class="uni-quick-link-desc">Résultats du semestre</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_student_classes') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-purple text-white">
                    <i class="bi bi-people-fill"></i>
                </div>
                <span class="uni-quick-link-title">Mes Classes</span>
                <p class="uni-quick-link-desc">Voir vos inscriptions</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_job_offer_index') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-danger text-white">
                    <i class="bi bi-briefcase-fill"></i>
                </div>
                <span class="uni-quick-link-title">Offres d'emploi</span>
                <p class="uni-quick-link-desc">Stages et opportunités</p>
            </a>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-2">
            <a href="{{ path('app_forum') }}" class="uni-quick-link">
                <div class="uni-quick-link-icon bg-gradient-warning text-white">
                    <i class="bi bi-chat-square-text-fill"></i>
                </div>
                <span class="uni-quick-link-title">Forum</span>
                <p class="uni-quick-link-desc">Échanger avec la communauté</p>
            </a>
        </div>
    </div>

    {# AI Recommendations Alert #}
    {% if recommendations|length > 0 %}
    <div class="alert alert-warning mb-4">
        <div>
            <i class="bi bi-robot" style="font-size:1.5rem"></i>
        </div>
        <div class="flex-grow-1">
            <h6 class="alert-heading mb-1">Recommandations IA</h6>
            <p class="mb-2">Notre système d'intelligence artificielle a détecté {{ recommendations|length }} cours où vous pourriez améliorer vos performances.</p>
            <a href="{{ path('app_espace_etudiant_recommendations') }}" class="btn btn-warning btn-sm">
                <i class="bi bi-arrow-right"></i> Voir les recommandations
            </a>
        </div>
    </div>
    {% endif %}

    {# Recent Grades #}
    <div class="card card-static">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-clock-history me-2 text-primary"></i>Notes Récentes</h5>
            <a href="{{ path('app_espace_etudiant_grades') }}" class="btn btn-sm btn-outline-primary">Voir tout</a>
        </div>
        <div class="card-body p-0">
            {% if recentGrades|length > 0 %}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="uni-thead">
                        <tr>
                            <th>Cours</th>
                            <th>Évaluation</th>
                            <th>Note</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for grade in recentGrades %}
                        {% set maxScore = 20 %}
                        <tr>
                            <td><strong>{{ grade.assessment.course ? grade.assessment.course.title : 'N/A' }}</strong></td>
                            <td>{{ grade.assessment.title }}</td>
                            <td>
                                <span class="badge {% if grade.score >= 12 %}bg-success{% elseif grade.score >= 10 %}bg-warning{% else %}bg-danger{% endif %}">
                                    {{ grade.score }}/{{ maxScore }}
                                </span>
                            </td>
                            <td><small class="text-muted">{{ grade.assessment.date ? grade.assessment.date|date('d/m/Y') : 'N/A' }}</small></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-inbox text-muted" style="font-size:2.5rem"></i>
                <p class="text-muted mt-2">Aucune note disponible pour le moment.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
